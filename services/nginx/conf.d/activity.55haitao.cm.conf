server {
    listen        80;
    listen        443 ssl http2;

    # 修改这里 改为自己用的
    server_name activity.55haitao.cm;
    root /data/www/55haitao-activity;
    index index.html index.php;
    access_log          /var/log/nginx/activity.55haitao.cm_access.log main;
    error_log           /var/log/nginx/activity.55haitao.cm_error.log info;
    # 修改这里 改为自己用的

    # cert存储位置
    # ssl_certificate        /etc/nginx/certs/default.cert;
    # ssl_certificate_key    /etc/nginx/certs/default.key;
    include conf.d/snippets/ssl.conf;

    # Header telling older browsers (IE) to use the latest ID version
    # or a Chrome rendering engine, if available
    add_header X-UA-Compatible "IE=Edge,chrome=1";
    add_header X-Frame-Options SAMEORIGIN;
    add_header X-Content-Type-Options nosniff;


    ##################################################################################################
    # rewrite区 项目自定义rewrite
    ########################2015-8-18参考web01机器添加
    rewrite ^/bbs/app.php(.*)$ /?c=App last;
    rewrite  ^/bbs/2015visa.php(.*)$ /?c=visa2015&a=index last;
    rewrite  ^/bbs/deal_recv.php$ /?c=Api&a=get_dealamreport last;
    rewrite  ^/wechat/(.*)$ /?c=visa2015&a=index last;
    rewrite ^/bbs/connect.php(.*)  http://my.dev.55haitao.com/?c=Member&a=qq_callback last;
    rewrite ^/weibo/weibo_callback.php(.*) http://my.dev.55haitao.com/?c=Member&a=sina_callback last;
    rewrite ^/bbs/xwb.php?m=xwbAuth.authCallBack http://my.dev.55haitao.com/?c=Member&a=sina_callback last;
    rewrite ^/(.*)/data/attachment/(.*) http://cdn2.55haitao.com/bbs/data/attachment/$2 permanent;
    rewrite ^/bbs/(.*) http://bbs.dev.55haitao.com/$1 permanent;
    ##################################################

    ##################08-25##########################
    rewrite ^/search/deal/(.*)?p=(.*)$ /?c=Search&a=index&keywords=$1&p=$2 last;
    rewrite ^/search/thread/(.*)?p=(.*)$ /?c=Search&a=topical&keywords=$1&p=$2 last;
    rewrite ^/search/all/(.*)?p=(.*)$ /?c=Search&a=allsearch&keywords=$1&p=$2 last;
    rewrite ^/search/deal/(.*)$ /?c=Search&a=index&keywords=$1&p=1 last;
    rewrite ^/search/thread/(.*)$ /?c=Search&a=topical&keywords=$1&p=1 last;
    rewrite ^/search/all/(.*)$ /?c=Search&a=allsearch&keywords=$1&p=1 last;
    rewrite ^/springfestival$ /?c=Special&a=index&name=2016-springday last;
    rewrite ^/stag/([0-9]+).html$ /?c=Search&a=index&stag=$1 last;
    ################################################

    rewrite ^/aboutus/(.*).html$ /?c=Help&a=aboutas&act=$1 last;
    rewrite ^/api/uc.php$ /?c=UcApi&a=index last;

    #商家链接优化
    rewrite ^/store\/([0-9]+)-([0-9]+)-([,\w]+)-([0-9]+)-(\w+)-([0-9]+).html$ /?c=Store&a=index&category=$1&country=$2&support=$3&orderby=$4&name=$5&p=$6 last;

    #商家列表
    rewrite ^/stores/$ /?c=Store&a=index last;

    #商家详细
    rewrite ^/store/(.*).html$ /?c=Store&a=view&urlname=$1 last;

    #优惠列表
    #rewrite ^/deals/$ /?c=Deals&a=index last;
    #商家详细
    rewrite ^/in-store-cash-back/$ /?c=Instore&a=index last;

    if ( $http_host ~* fashion.dev.55haitao.com){
            rewrite ^/deals/([0-9]+).html$ /?c=Fashion&a=view&id=$1  last;
    }
    rewrite ^/deals/([0-9]+).html$ /?c=Deals&a=view&id=$1 last;

    rewrite ^/deals/([0-9]+)$ /deals/$1/ permanent;
    rewrite ^/deals/([0-9]+)/$ /?c=Deals&a=view&id=$1 last;

    #转运板块
    #rewrite ^/shipping/$ /?c=Shipping&a=index last;
    rewrite ^/shipping/$ /?c=Transport&a=index last;
    rewrite ^/shipping/(.*)/(.*)$ /?c=Transport&a=transportlist&country=$1&letter=$2 last;
    rewrite ^/shipping/([0-9]+).html$ /?c=Transport&a=transportview&id=$1 last;
    rewrite ^/shipping/settled$ /?c=Transport&a=transportapply last;
    rewrite ^/shipping/list$ /?c=Transport&a=transportlist last;
    rewrite ^/edit/info/([0-9]+)$ /?c=Transport&a=trans_base&id=$1 last;
    rewrite ^/edit/path/([0-9]+)$ /?c=Transport&a=trans_route_list&id=$1 last;
    rewrite ^/edit/serves/([0-9]+)$ /?c=Transport&a=trans_serves&id=$1 last;
    rewrite ^/edit/storage/([0-9]+)$ /?c=Transport&a=storage_list&id=$1 last;
    rewrite ^/edit/activity/([0-9]+)$ /?c=Transport&a=issue_activity&id=$1 last;
    rewrite ^/edit/vas/([0-9]+)$ /?c=Transport&a=trans_vas_list&id=$1 last;

    #GO
    rewrite ^/g/([0-9]+)-([a-z])-([0-9]+)$ /?c=Go&a=index&storeid=$1&type=$2&id=$3 last;
    rewrite ^/link-([0-9]+).html$ /?c=Go&a=shorturl&id=$1 last;

    #联盟链接生成API
    rewrite ^/bbs/union_api.php$ /?c=Api&a=union_api last;
    #55帮你买返回信息接受API
    rewrite ^/get_st_helpbuy.php$ /?c=Api&a=get_helpbuy last;

    #专题跳转
    rewrite ^/special/([0-9]+).html$ /?c=Special&a=index&id=$1 last;
    rewrite ^/special/([0-9a-zA-Z-]+).html$ /?c=Special&a=index&name=$1 last;
    rewrite ^/BlackFriday2015$  /?c=Blackfriday&a=black_index last;

    #帮助
    rewrite ^/help$ /?c=Help&a=index last;
    rewrite ^/help-(\d+).html$ /?c=Help&a=index&id=$1 last;

    rewrite ^/search/deal/(.*)/p/(.*)$ /?c=Search&a=index&keywords=$1&p=$2 last;
    rewrite ^/search/thread/(.*)/p/(.*)$ /?c=Search&a=topical&keywords=$1&p=$2 last;
    rewrite ^/search/allsearch/(.*)/p/(.*)$ /?c=Search&a=allsearch&keywords=$1&p=$2 last;

    rewrite ^/register_success$ /?c=Index&a=register_success last;
    rewrite ^/sitemap$ /?c=SiteMap&a=index last;

    rewrite ^/app_download$ /?c=Special&a=index&name=app_download last;
    rewrite ^/app_guide$ /?c=Special&a=index&name=app_guide last;


    #优惠搜索
    rewrite ^/search/deal /?c=Search&a=index last;
    #帖子搜索
    rewrite ^/search/thread /?c=Search&a=topical last;
    #全部搜索
    rewrite ^/search/all /?c=Search&a=allsearch last;
    rewrite ^/love55$ /?c=Haitaofestival&a=pearl_exchange last;
    rewrite ^/wenjuan$  /?c=Wenjuan&a=index last;
    rewrite ^/wenjuan/post /?c=Wenjuan&a=post last;


    rewrite ^/nanfaner/index.html$ /?c=Man&a=index last;
    rewrite ^/nanfaner/$ /?c=Man&a=news_list last;
    rewrite ^/nanfaner/([0-9]+).html$ /?c=Man&a=view&id=$1 last;

    rewrite ^/hotdeals/$ /?c=Hotdeal&a=deallist last;
    rewrite ^/hotdeals$ /?c=Hotdeal&a=deallist last;

    rewrite ^/hotdeal/([0-9]+).html$ /?c=Hotdeal&a=dealdetail&id=$1 last;

    #优惠合集详情路由
    rewrite ^/collection/([0-9]+)$ /collection/$1/ permanent;
    rewrite ^/collection/([0-9]+)/$ /?c=Collections&a=detail&collection_id=$1 last;

    if ($http_host ~ ^guide.dev.55haitao.com$){
            rewrite ^/$ /?c=Guide&a=index last;
            rewrite ^/([0-9]+)/*$ /?c=Guide&a=guide_list&category_id=$1 last;
            rewrite ^/([0-9]+)/([0-9]+)/*$ /?c=Guide&a=guide_list&category_id=$1&pid=$2 last;
            rewrite ^/article/([0-9]+).html/*$ /?c=Guide&a=detail&id=$1 last ;
            rewrite ^/([0-9]+)/*$ /?c=Guide&a=guide_list&ppinyin=$1 last;
            rewrite ^/([a-zA-Z0-9]+)/([A-Za-z0-9]+)/*$ /?c=Guide&a=guide_list&ppinyin=$1&pinyin=$2 last;
            rewrite ^/([a-zA-Z0-9]+)/*$ /?c=Guide&a=guide_list&ppinyin=$1 last;
            rewrite ^/Guide/guide_list/([A-Za-z0-9]+)/([0-9]+)/$ /?c=Guide&a=guide_list&ppinyin=$1&p=$2 last;
    }

    ##################################################################################################

    # Headers for static assets
    include conf.d/snippets/static.conf;

    include conf.d/snippets/denyfile.conf;

    include conf.d/snippets/tp_rewrite.conf;

    #Default PHP Handler
    location ~ \.php$ {
        fastcgi_pass  php-fpm56:9000; # !!!这里修改为php-fpm56或者php-fpm72 即可使用对应版本的php

        fastcgi_index /index.php;

        include fastcgi_params;
        include conf.d/snippets/php.conf;
    }
}